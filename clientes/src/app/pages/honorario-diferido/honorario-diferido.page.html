<div class="content mat-elevation-z8" [class.blur-content]="cargando">

  <div class="toolbar">
    <ion-input style="color: white; font-weight: bold;"
      placeholder="Buscar por número o año"
      class="input-busqueda"
      [(ngModel)]="busqueda"
      (ngModelChange)="buscar()">
    </ion-input>

    <button mat-button class="list-button">
      <mat-icon style="color: #ffffff">download</mat-icon>
    </button>
    <button mat-button class="list-button">
      <mat-icon style="color: #ffffff">more_vert</mat-icon>
    </button>

    <label for="styledSelect1" class="custom-select">
      <select id="styledSelect1" name="options" (change)="cambiarEstado($event)">
        <option value="">Seleccionar estado</option>
        <option value="sentencia" selected>Sentencia</option>
        <option value="cobrado">Cobrado</option>

      </select>
    </label>
  </div>

  <div *ngIf="cargando" class="fullscreen-loader">
    <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner>
  </div>

  <div class="table-container" *ngIf="!cargando">
    <table>
      <thead>
        <tr>
          <th (click)="ordenarPor('numero')" [class.activo]="ordenCampo === 'numero'">
            Nº expediente
            <span class="flecha" *ngIf="ordenCampo === 'numero'">{{ ordenAscendente ? '↑' : '↓' }}</span>
          </th>
          <th>
            Caratula
          </th>
          <th  (click)="ordenarPor('juzgado')" [class.activo]="ordenCampo === 'juzgado'">
            Juzgado
            <span class="flecha" *ngIf="ordenCampo === 'juzgado'">{{ ordenAscendente ? '↑' : '↓' }}</span>
          </th>
          <th>
            Cobranza
          </th>
          <th>
            Estado
          </th>
          <th>
            Ultimo movimiento
          </th>
          <th>
            Importe
          </th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let item of honorariosDiferidosOrdenados"
        (mouseenter)="item.hover = true"
        (mouseleave)="item.hover = false">

<!-- Filtrar acá adentro -->
<ng-container *ngIf="!(estado === 'sentencia' && item.capitalCobrado && item.honorarioCobrado)">

<tr [class.hover]="item.hover" *ngIf="((estado == 'sentencia' && !item.honorarioCobrado) || (estado == 'sentencia' && !item.capitalCobrado) ||
(estado == 'cobrado' && item.honorarioCobrado) || (estado == 'cobrado' && item.capitalCobrado))">
<td *ngIf="((estado == 'sentencia' && !item.honorarioCobrado) || (estado == 'sentencia' && !item.capitalCobrado) ||
(estado == 'cobrado' && item.honorarioCobrado) || (estado == 'cobrado' && item.capitalCobrado))" rowspan="2" style="background-color: #07295c;">{{ item.numero }}/{{ item.anio }}</td>
<td  *ngIf="((estado == 'sentencia' && !item.honorarioCobrado) || (estado == 'sentencia' && !item.capitalCobrado) ||
(estado == 'cobrado' && item.honorarioCobrado) || (estado == 'cobrado' && item.capitalCobrado))" rowspan="2" style="background-color: #07295c;">
  <div *ngIf="item.clientes.length === 1">
    {{ item.clientes[0]!.nombre }} {{ item.clientes[0].apellido }} contra {{ item.demandadoModel!.nombre }}
  </div>
  <div *ngIf="item.clientes.length > 1">
    {{ item.clientes[0]!.nombre }} {{ item.clientes[0].apellido }} y otros contra {{ item.demandadoModel!.nombre }}
  </div>
  <div *ngIf="item.clientes.length === 0">
    (sin actora) contra {{ item.demandadoModel!.nombre }}
  </div>
</td>
<td *ngIf="((estado == 'sentencia' && !item.honorarioCobrado) || (estado == 'sentencia' && !item.capitalCobrado) ||
(estado == 'cobrado' && item.honorarioCobrado) || (estado == 'cobrado' && item.capitalCobrado))" rowspan="2" style="background-color: #07295c;">{{ item.juzgadoModel.tipo }}</td>

<!-- CAPITAL -->
<td *ngIf="(!item.capitalCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.capitalCobrado)">Capital</td>
<td *ngIf="(!item.capitalCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.capitalCobrado)">
  {{ item.subEstadoCapitalSeleccionado || item.estadoLiquidacionCapitalSeleccionado }}
</td>
<td *ngIf="(!item.capitalCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.capitalCobrado)">
  {{ item.fechaCapitalSubestado?.split('T')[0] || item.fechaLiquidacionCapital?.split('T')[0] }}
</td>
<td *ngIf="(!item.capitalCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.capitalCobrado)">
  <span *ngIf="item.montoLiquidacionCapital">
    ${{ item.montoLiquidacionCapital | number:'1.0-0' }}
    <button *ngIf="!item.capitalCobrado" mat-icon-button color="primary" (click)="cobrar('capital', item)">
      <mat-icon style="color: limegreen">attach_money</mat-icon>
    </button>
    <mat-icon *ngIf="item.capitalCobrado" style="color: limegreen">check_circle</mat-icon>
  </span>
  <span *ngIf="!item.montoLiquidacionCapital">-</span>
</td>
</tr>

<!-- HONORARIO -->
<tr [class.hover]="item.hover">
<td *ngIf="(!item.honorarioCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.honorarioCobrado)">Honorarios</td>
<td *ngIf="(!item.honorarioCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.honorarioCobrado)">
  {{ item.subEstadoHonorariosSeleccionado || item.estadoLiquidacionHonorariosSeleccionado }}
</td>
<td *ngIf="(!item.honorarioCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.honorarioCobrado)">
  {{ item.fechaHonorariosSubestado?.split('T')[0] || item.fechaLiquidacionHonorarios?.split('T')[0] }}
</td>
<td *ngIf="(!item.honorarioCobrado && estado == 'sentencia') || (estado == 'cobrado' && item.honorarioCobrado)">
  <span *ngIf="item.montoLiquidacionHonorarios">
    ${{ item.montoLiquidacionHonorarios | number:'1.0-0' }}
    <button *ngIf="!item.honorarioCobrado" mat-icon-button color="primary" (click)="cobrar('honorario', item)">
      <mat-icon style="color: limegreen">attach_money</mat-icon>
    </button>
    <mat-icon *ngIf="item.honorarioCobrado" style="color: limegreen">check_circle</mat-icon>
  </span>
</td>
</tr>

</ng-container>
</ng-container>

      </tbody>
      
      
      
    </table>
  </div>

</div>
