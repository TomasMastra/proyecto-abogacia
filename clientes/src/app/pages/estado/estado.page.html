<div> 

  

<!-- -->
    <mat-sidenav-content>
      <div class="content mat-elevation-z8">
        <ion-list class="lista-clientes">
          <!-- Secci贸n 1: B煤squeda de expediente -->
          <div *ngIf="menu == '1'">

            <div class="toolbar">
              <ion-input 
                placeholder="N煤mero" 
                class="input-busqueda"
                (keypress)="validateNumber($event)"
                [(ngModel)]="numero">
              </ion-input>
      
              <ion-input 
                placeholder="A帽o" 
                class="input-busqueda"
                (keypress)="validateNumber($event)"
                [(ngModel)]="anio">
              </ion-input>

              <form [formGroup]="form">

              <mat-form-field appearance="outline" class="full-width" style="width: 100%">
                <mat-label style="color: white">Seleccionar juzgado</mat-label>
                <mat-select style="color: white" formControlName="juez" [(ngModel)]="juzgadoSeleccionado">
                  <mat-option *ngFor="let juzgado of juzgados" [value]="juzgado">
                    {{ juzgado.nombre }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              </form>
              

            </div>

            <button mat-button class="menu-button" (click)="buscar()">
              <mat-icon style="color: #ffffff">search</mat-icon>
              <span style="color: #ffffff">Buscar expediente</span>
            </button>
          </div>

          <!-- Secci贸n 2: Informaci贸n del expediente -->
          <div *ngIf="menu == '2'">
            <button mat-button class="menu-button" (click)="cambiarMenu('1')">
              <mat-icon style="color: #ffffff">arrow_back_ios</mat-icon>
              <span style="color: #ffffff">Regresar</span>
            </button>

<div class="expediente-info">
  <h6 *ngIf="expediente.clientes.length === 1">
    {{ expediente.numero }}/{{ expediente.anio }} {{ expediente.clientes[0].nombre }} {{ expediente.clientes[0].apellido }} contra {{ expediente.demandadoModel.nombre }}
  </h6>
  <h6 *ngIf="expediente.clientes.length > 1">
    {{ expediente.numero }}/{{ expediente.anio }} {{ expediente.clientes[0].nombre }} {{ expediente.clientes[0].apellido }} y otros contra {{ expediente.demandadoModel.nombre }}
  </h6>
  <h6 *ngIf="expediente.clientes.length === 0">
    {{ expediente.numero }}/{{ expediente.anio }} (sin actora) contra {{ expediente.demandadoModel.nombre }}
  </h6>
</div>



            <div class="toolbar">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label style="color: white">Estado del expediente</mat-label>
                <mat-select style="color: white" [(ngModel)]="estadoSeleccionado">
                  <mat-option *ngFor="let estado of estados" [value]="estado">
                    {{ estado }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

            </div>
          
            <div style="padding: 16px;">
              <!-- Estado del expediente -->

              
              <form [formGroup]="form">

              <div class="divider-container">
                <mat-divider class="white-divider"></mat-divider>
                <span class="divider-text">Ultimo movimiento</span>
                <mat-divider class="white-divider"></mat-divider>
              </div>
              <ion-input
              placeholder="Ultimo movimiento"
              type="date"
              class="input-busqueda"
              formControlName="ultimo_movimiento"
              name="ultimo_movimiento"
              id="ultimo_movimiento">
            </ion-input>
              </form>
              
              <!-- Formulario reactivo -->
              <form [formGroup]="form" *ngIf="estadoSeleccionado=='sentencia'">



                <div class="divider-container">
                  <mat-divider class="white-divider"></mat-divider>
                  <span class="divider-text">Detalles de la sentencia</span>
                  <mat-divider class="white-divider"></mat-divider>
                </div>

                <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="32px">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label style="color: white">Honorario</mat-label>
                    <mat-select style="color: white" formControlName="honorario" [(ngModel)]="honorarioSeleccionado" (selectionChange)="actualizarMonto($event.value); actualizarHonorario(); actualizarValidacionesCondicionales()">
                      <mat-option *ngFor="let honorario of honorarios" [value]="honorario">
                        {{ honorario }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.controls?.['honorario']?.invalid && (form.controls?.['honorario']?.dirty || form.controls?.['honorario']?.touched)">
                      <span *ngIf="form.controls?.['honorario']?.errors?.['required']" style="color:red">El honorario es requerido</span>
                    </mat-error>
                  </mat-form-field>
                
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label style="color: white">Jueces</mat-label>
                    <mat-select style="color: white" formControlName="juez" [(ngModel)]="juezSeleccionado">
                      <mat-option *ngFor="let juez of jueces" [value]="juez">
                        {{ juez.nombre }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.controls?.['juez']?.invalid && (form.controls?.['juez']?.dirty || form.controls?.['juez']?.touched)">
                      <span *ngIf="form.controls?.['juez']?.errors?.['required']" style="color:red">El juez es requerido</span>
                    </mat-error>
                  </mat-form-field>
                </div>
                
                

                <div class="toolbar">
                <!-- MONTO -->
                  <ion-input
                  placeholder="monto"
                  (keypress)="validateNumber($event)"
                  type="number"
                  class="input-busqueda"
                  formControlName="monto"
                  name="monto"
                  id="monto">
                </ion-input>
        
        <!-- Campo de fecha de sentencia -->
        <ion-input
          placeholder="Fecha de sentencia"
          type="date"
          class="input-busqueda"
          formControlName="fecha_sentencia"
          name="fecha_sentencia"
          id="fecha_sentencia">
        </ion-input>

                </div>
                
      <form [formGroup]="form" >
                
<!--  CAPITAL -->
<div class="divider-container">
  <mat-divider class="white-divider"></mat-divider>
  <span class="divider-text">Detalles del Capital</span>
  <mat-divider class="white-divider"></mat-divider>
</div>

<!-- Contenedor general -->
<div style="display: flex; flex-direction: column; gap: 16px;">

  <!-- Fila de selectores -->
  <div style="display: flex; gap: 16px;">

    <!-- Estado del Capital -->
    <mat-form-field appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Estado del Capital</mat-label>
      <mat-select style="color: white" [(ngModel)]="estadoCapitalSeleccionado" name="estadoCapitalSeleccionado" (selectionChange)="actualizarEstadoCapital(); actualizarValidacionesCondicionales()">
        <mat-option value="apelado">Apelado</mat-option>
        <mat-option value="firme">Firme</mat-option>
        <mat-option value="pendiente">Pendiente</mat-option>

      </mat-select>
    </mat-form-field>

    <!-- Subestado o Estado de liquidaci贸n -->
    <mat-form-field *ngIf="estadoCapitalSeleccionado == 'apelado'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Subestado del Capital</mat-label>
      <mat-select style="color: white" [(ngModel)]="subEstadoCapitalSeleccionado" name="subEstadoCapitalSeleccionado" (selectionChange)="actualizarValidacionesCondicionales()">
        <mat-option value="pendiente de elevacion">Pendiente de elevaci贸n</mat-option>
        <mat-option value="en sala">En sala</mat-option>
        <mat-option value="resolucion sala">Resoluci贸n sala</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field *ngIf="estadoCapitalSeleccionado == 'pendiente'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Subestado del Capital</mat-label>
      <mat-select style="color: white" [(ngModel)]="subEstadoCapitalSeleccionado" name="subEstadoCapitalSeleccionado" (selectionChange)="actualizarValidacionesCondicionales()">
        <mat-option value="pendiente de elevacion">Pendiente de elevaci贸n</mat-option>
        <mat-option value="en sala">En sala</mat-option>
        <mat-option value="resolucion sala">Resoluci贸n sala</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field *ngIf="estadoCapitalSeleccionado == 'firme'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Estado de liquidaci贸n Capital</mat-label>
      <mat-select style="color: white" [(ngModel)]="estadoLiquidacionCapitalSeleccionado" name="estadoLiquidacionCapitalSeleccionado" (selectionChange)="actualizarEstadoDeLiquidacionCapital(); actualizarValidacionesCondicionales()">
        <mat-option value="liquidacion pendiente">Liquidaci贸n pendiente</mat-option>
        <mat-option value="liquidacion practicada">Liquidaci贸n practicada</mat-option>
        <mat-option value="traslado liquidacion">Traslado de liquidaci贸n</mat-option>
        <mat-option value="solicita aprobacion">Solicita se apruebe liquidaci贸n</mat-option>
      </mat-select>
    </mat-form-field>

  </div>

  <!-- Fila de inputs -->
  <div style="display: flex; flex-direction: column; gap: 16px;">

    <!-- Input fecha -->
    <ion-input 
      *ngIf="estadoCapitalSeleccionado == 'apelado'"
      type="date"
      class="input-busqueda"
      [(ngModel)]="fechaCapitalSubestado"
      name="fechaCapitalSubestado">
    </ion-input>

    <ion-input 
    *ngIf="estadoCapitalSeleccionado == 'pendiente'"
    type="date"
    class="input-busqueda"
    [(ngModel)]="fechaCapitalSubestado"
    name="fechaCapitalSubestado">
  </ion-input>

    <ion-input 
      *ngIf="estadoCapitalSeleccionado == 'firme'"
      type="date"
      class="input-busqueda"
      [(ngModel)]="fechaLiquidacionCapital"
      name="fechaLiquidacionCapital">
    </ion-input>

    <!-- Input monto -->
    <ion-input
      *ngIf="estadoLiquidacionCapitalSeleccionado == 'liquidacion practicada'"
      placeholder="Monto Capital"
      type="number"
      class="input-busqueda"
      [(ngModel)]="montoLiquidacionCapital"
      name="montoLiquidacionCapital">
    </ion-input>

  </div>

</div>

<!--  HONORARIOS -->
<div class="divider-container">
  <mat-divider class="white-divider"></mat-divider>
  <span class="divider-text">Detalles del Honorario</span>
  <mat-divider class="white-divider"></mat-divider>
</div>

<!-- Contenedor general -->
<div style="display: flex; flex-direction: column; gap: 16px;">

  <!-- Fila de selectores -->
  <div style="display: flex; gap: 16px;">

    <!-- Estado de Honorarios -->

    <!-- CASO REGULACION Y COSTAS POR SU ORDEN-->
    <mat-form-field appearance="outline" style="flex: 1;" *ngIf="honorarioSeleccionado != 'Difiere regulacion 1潞 instancia'">
      <mat-label style="color: white">Estado de Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="estadoHonorariosSeleccionado" name="estadoHonorariosSeleccionado" (selectionChange)="actualizarEstadoLiquidacionHonorarios(); actualizarValidacionesCondicionales(); actualizarEstadoHonorario()">
        <mat-option [value]="'apelado'" [disabled]="deshabilitarApeladoOFirme">Apelado</mat-option>
        <mat-option [value]="'firme'" [disabled]="deshabilitarApeladoOFirme">Firme</mat-option>
        <mat-option [value]="'pendiente'" [disabled]="deshabilitarApeladoOFirme">Pendiente</mat-option>

      </mat-select>
    </mat-form-field>

    <!-- CASO DIFIERE REGLACION-->
    <mat-form-field appearance="outline" style="flex: 1;" *ngIf="honorarioSeleccionado == 'Difiere regulacion 1潞 instancia'">
      <mat-label style="color: white">Estado de Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="estadoHonorariosSeleccionado" name="estadoHonorariosSeleccionado" (selectionChange)="actualizarEstadoLiquidacionHonorarios(); actualizarValidacionesCondicionales()">
        <mat-option [value]="'diferido'">Diferido</mat-option>
      </mat-select>
    </mat-form-field>
    

    <!-- Subestado o Estado de liquidaci贸n -->
    <mat-form-field *ngIf="estadoHonorariosSeleccionado === 'apelado'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Subestado de Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="subEstadoHonorariosSeleccionado" name="subEstadoHonorariosSeleccionado" (selectionChange)="actualizarValidacionesCondicionales()">
        <mat-option value="pendiente de elevacion" [disabled]="deshabilitarApeladoOFirme">Pendiente de elevaci贸n</mat-option>
        <mat-option value="en sala" [disabled]="deshabilitarApeladoOFirme">En sala</mat-option>
        <mat-option value="resolucion sala" [disabled]="deshabilitarApeladoOFirme">Resoluci贸n sala</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field *ngIf="estadoHonorariosSeleccionado === 'pendiente'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Subestado de Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="subEstadoHonorariosSeleccionado" name="subEstadoHonorariosSeleccionado" (selectionChange)="actualizarValidacionesCondicionales()">
        <mat-option value="pendiente de elevacion" [disabled]="deshabilitarApeladoOFirme">Pendiente de elevaci贸n</mat-option>
        <mat-option value="en sala" [disabled]="deshabilitarApeladoOFirme">En sala</mat-option>
        <mat-option value="resolucion sala" [disabled]="deshabilitarApeladoOFirme">Resoluci贸n sala</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field *ngIf="estadoHonorariosSeleccionado === 'diferido'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Subestado de Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="subEstadoHonorariosSeleccionado" name="subEstadoHonorariosSeleccionado" (selectionChange)="actualizarValidacionesCondicionales()">
        <mat-option value="diferido">Diferido</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field *ngIf="estadoHonorariosSeleccionado === 'firme'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Estado de liquidaci贸n Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="estadoLiquidacionHonorariosSeleccionado" name="estadoLiquidacionHonorariosSeleccionado" (selectionChange)="actualizarEstadoLiquidacionHonorarios(); actualizarValidacionesCondicionales()">
        <mat-option value="liquidacion pendiente">Liquidaci贸n pendiente</mat-option>
        <mat-option value="liquidacion practicada">Liquidaci贸n practicada</mat-option>
        <mat-option value="traslado liquidacion">Traslado de liquidaci贸n</mat-option>
        <mat-option value="solicita aprobacion">Solicita se apruebe liquidaci贸n</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- usar el mismo que el estado apelado-->
   <!--  <mat-form-field *ngIf="estadoHonorariosSeleccionado === 'diferido'" appearance="outline" style="flex: 1;">
      <mat-label style="color: white">Subestado de Honorarios</mat-label>
      <mat-select style="color: white" [(ngModel)]="subEstadoHonorariosSeleccionado" name="subEstadoHonorariosSeleccionado">
        <mat-option value="diferido">Diferido</mat-option>
      </mat-select>
    </mat-form-field> -->

  </div>

  <!-- Fila de inputs -->
  <div style="display: flex; flex-direction: column; gap: 16px;">

    <!-- Input fecha -->
    <ion-input 
      *ngIf="estadoHonorariosSeleccionado === 'apelado'"
      type="date"
      class="input-busqueda"
      [(ngModel)]="fechaHonorariosSubestado"
      name="fechaHonorariosSubestado">
    </ion-input>

    <ion-input 
    *ngIf="estadoHonorariosSeleccionado === 'pendiente'"
    type="date"
    class="input-busqueda"
    [(ngModel)]="fechaHonorariosSubestado"
    name="fechaHonorariosSubestado">
  </ion-input>

    <ion-input 
    *ngIf="estadoHonorariosSeleccionado === 'diferido'"
    type="date"
    class="input-busqueda"
    [(ngModel)]="fechaHonorariosSubestado"
    name="fechaHonorariosSubestado">
  </ion-input>

    <ion-input 
      *ngIf="estadoHonorariosSeleccionado === 'firme'"
      type="date"
      class="input-busqueda"
      [(ngModel)]="fechaLiquidacionHonorarios"
      name="fechaLiquidacionHonorarios">
    </ion-input>

    <!-- Input monto -->
    <ion-input
      *ngIf="estadoLiquidacionHonorariosSeleccionado == 'liquidacion practicada'"
      placeholder="Monto Honorarios"
      type="number"
      class="input-busqueda"
      [(ngModel)]="montoLiquidacionHonorarios"
      name="montoLiquidacionHonorarios">
    </ion-input>

  </div>

</div>


                </form>
                


              
              </form>

              <button mat-button class="menu-estado" style="background-color:#015dbb" (click)="actualizarEstado()">
                <span style="color: #ffffff">Actualizar estado</span>
              </button>

            </div>
          </div>

        </ion-list>
      </div>
    </mat-sidenav-content>
</div>

<div *ngIf="cargando" class="loader-container">
  <mat-progress-spinner mode="indeterminate" color="accent"></mat-progress-spinner> 
</div>